---
import Layout from "../../layouts/Layout.astro";
import Home from "../../components/views/Home.astro";
import Solutions from "../../components/views/Solutions.astro";
import Booking from "../../components/views/Booking.astro";
import LegalLayout from "../../layouts/LegalLayout.astro";
import PrivacyView from "../../components/views/PrivacyView.astro";
import TermsView from "../../components/views/TermsView.astro";
import {
    TASKS,
    getSeo,
    getHtmlIdFromRouteId,
    isSolutionsChild,
    type RouteId,
} from "../../lib/routes";

export async function getStaticPaths() {
    const paths: {
        params: { lang: string; slug: string };
        props: { id: RouteId };
    }[] = [];

    (["es", "en"] as const).forEach((lang) => {
        TASKS.forEach((task) => {
            if (task.id === "home") return;

            const slug = task.slug[lang];
            if (slug) {
                paths.push({
                    params: { lang, slug },
                    props: { id: task.id },
                });
            }
        });
    });
    return paths;
}

const { lang } = Astro.params;
const { id } = Astro.props;
const currentLang = (lang as "es" | "en") || "es";
const seo = getSeo(id as RouteId, currentLang);
const isSolutionView = id === "solutions" || isSolutionsChild(id);
const initialSection = isSolutionsChild(id)
    ? getHtmlIdFromRouteId(id as RouteId)
    : undefined;
---

{
    id === "privacy" || id === "terms" ? (
        <LegalLayout
            title={seo.title}
            description={seo.description}
            lang={currentLang}
            lastUpdated="1 feb 2025"
        >
            {id === "privacy" && <PrivacyView lang={currentLang} />}
            {id === "terms" && <TermsView lang={currentLang} />}
        </LegalLayout>
    ) : (
        <Layout
            title={seo.title}
            description={seo.description}
            lang={currentLang}
            transparent={false}
        >
            {isSolutionView && (
                <Solutions lang={currentLang} initialSection={initialSection} />
            )}
            {id === "booking" && <Booking lang={currentLang} />}
        </Layout>
    )
}
---
