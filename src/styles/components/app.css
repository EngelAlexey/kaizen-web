@layer components {
    .page-app .sidebar {
        width: 240px;
        flex-shrink: 0;
        border-right: 1px solid var(--color-border);
        background: var(--color-panel);
        position: sticky;
        top: 0;
        height: 100vh;
        z-index: 40;
    }

    .page-app .sidebar-brand {
        display: flex;
        align-items: center;
        gap: .75rem;
        padding: .9rem 1rem;
    }

    .page-app .nav-item {
        position: relative;
        isolation: isolate;
        display: flex;
        align-items: center;
        gap: .75rem;
        margin: .25rem .75rem;
        padding: .65rem .75rem;
        border-radius: 14px;
        font-size: .9375rem;
        color: var(--color-foreground);
        transition: color .18s ease, transform .18s ease, box-shadow .18s ease;
    }

    .page-app .nav-item::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        z-index: 0;
        background: linear-gradient(90deg,
                rgba(229, 57, 53, 0) 0%,
                rgba(255, 94, 94, .30) 18%,
                rgba(229, 57, 53, .70) 55%,
                rgba(229, 57, 53, 0) 100%);
        transform-origin: left center;
        transform: scaleX(0);
        opacity: 0;
        pointer-events: none;
        transition: transform .35s cubic-bezier(.22, 1, .36, 1), opacity .25s ease;
    }

    .page-app .nav-item:hover::before {
        transform: scaleX(1);
        opacity: 1;
    }

    .page-app .nav-item:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-soft);
    }

    .page-app .nav-icon {
        width: 20px;
        height: 20px;
        flex: 0 0 20px;
        display: inline-grid;
        place-items: center;
        z-index: 1;
    }

    .page-app .nav-item span {
        position: relative;
        z-index: 1;
    }

    .page-app .nav-active {
        background: rgba(0, 0, 0, .06);
    }

    .dark .page-app .nav-active {
        background: rgba(255, 255, 255, .06);
    }

    .page-app .nav-active::before {
        opacity: 0 !important;
        transform: none !important;
    }

    .page-app .nav-active::after {
        content: "";
        position: absolute;
        left: -2px;
        top: 8px;
        bottom: 8px;
        width: 3px;
        border-radius: 999px;
        background: var(--color-primary);
        box-shadow: 0 8px 24px rgba(229, 57, 53, .35);
    }

    /* Botones de la App */
    .page-app .btn {
        display: inline-flex;
        align-items: center;
        gap: .5rem;
        padding: .55rem 1rem;
        border-radius: 999px;
        border: 1px solid var(--color-border);
        color: #fff;
        background: linear-gradient(180deg, var(--color-primary), var(--color-primary-hover));
        box-shadow: var(--shadow-soft);
        transition: filter .15s ease, transform .15s ease;
    }

    .page-app .btn:hover {
        filter: brightness(1.03);
        transform: translateY(-1px);
    }

    .page-app .btn-avatar {
        width: 40px;
        height: 40px;
        border-radius: 999px;
        display: grid;
        place-items: center;
        border: 1px solid var(--color-border);
        background: var(--color-panel);
    }

    .page-app .user-menu {
        min-width: 260px;
        padding: 8px;
        border: 1px solid var(--color-border);
        border-radius: 14px;
        background: var(--color-panel);
        box-shadow: var(--shadow-strong);
        animation: menuPop .16s ease both;
    }

    @keyframes menuPop {
        from {
            opacity: 0;
            transform: translateY(-6px) scale(.98)
        }

        to {
            opacity: 1;
            transform: none
        }
    }

    .page-app .user-menu a {
        display: flex;
        align-items: center;
        gap: .625rem;
        min-height: 44px;
        padding: .6rem .75rem;
        border-radius: 10px;
        line-height: 1.1;
        color: var(--color-foreground);
        text-decoration: none;
        transition: background-color .18s ease, transform .08s ease;
    }

    .page-app .user-menu a:hover {
        background: rgba(0, 0, 0, .06);
    }

    .dark .page-app .user-menu a:hover {
        background: rgba(255, 255, 255, .06);
    }

    .page-app .user-menu a:active {
        transform: scale(.985);
    }

    .page-app .user-menu .ico {
        width: 20px;
        height: 20px;
        flex: 0 0 20px;
        display: inline-grid;
        place-items: center;
    }

    .page-app .btn-theme {
        position: relative;
        overflow: hidden;
    }

    .page-app .btn-theme::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        box-shadow: 0 0 0 0 rgba(229, 57, 53, 0);
        opacity: 0;
        transition: box-shadow .35s ease, opacity .35s ease;
    }

    .page-app .btn-theme.pulse::after {
        box-shadow: 0 0 0 14px rgba(229, 57, 53, .16);
        opacity: 1;
    }

    .page-app .icon-theme {
        position: relative;
        width: 18px;
        height: 18px;
    }

    .page-app .icon-theme svg {
        position: absolute;
        inset: 0;
        transition: transform .35s cubic-bezier(.22, 1, .36, 1), opacity .25s ease;
    }

    .page-app .icon-theme .sun {
        opacity: 1;
        transform: rotate(0) scale(1);
    }

    .page-app .icon-theme .moon {
        opacity: 0;
        transform: rotate(-90deg) scale(.6);
    }

    .dark .page-app .icon-theme .sun {
        opacity: 0;
        transform: rotate(90deg) scale(.6);
    }

    .dark .page-app .icon-theme .moon {
        opacity: 1;
        transform: rotate(0) scale(1);
    }

    /* ====== Responsive App Shell  ====== */
    :root {
        --topbar-h: 56px;
    }

    @media (min-width:1024px) {
        :root {
            --topbar-h: 64px;
        }
    }

    .page-app {
        position: relative;
    }

    .page-app .content {
        min-width: 0;
    }

    @media (min-width:1024px) {
        .page-app .content {
            padding-left: 0;
        }
    }

    @media (max-width:1023px) {
        .page-app .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            height: 100dvh;
            width: 78vw;
            max-width: 320px;
            box-shadow: var(--shadow-strong);
            transform: translateX(-100%);
            transition: transform .25s cubic-bezier(.22, 1, .36, 1);
            z-index: 100;
        }

        .page-app .sidebar.open {
            transform: translateX(0);
        }

        .page-app .sidebar-backdrop {
            position: fixed;
            inset: 0;
            z-index: 90;
            background: rgba(0, 0, 0, .38);
            backdrop-filter: blur(1px);
            opacity: 0;
            pointer-events: none;
            transition: opacity .2s ease;
        }

        .page-app .sidebar-backdrop.show {
            opacity: 1;
            pointer-events: auto;
        }

    }

    .bi-frame {
        height: calc(100dvh - var(--topbar-h) - env(safe-area-inset-bottom, 0px));
    }

    .page-app .hamburger {
        display: inline-flex;
    }

    @media (min-width:1024px) {
        .page-app .hamburger {
            display: none;
        }
    }

    .page-app .btn-avatar,
    .page-app .btn-icon {
        width: 40px;
        height: 40px;
        border-radius: 999px;
        display: grid;
        place-items: center;
        line-height: 0;
    }

    .page-app .hamburger {
        width: 40px;
        height: 40px;
        border-radius: 999px;
        line-height: 0;
        display: none;
    }

    @media (max-width:1023px) {
        .page-app .hamburger {
            display: grid;
            place-items: center;
        }
    }

    @media (min-width:1024px) {
        .page-app .hamburger {
            display: none !important;
        }
    }
}